<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mixture Density Networks with Edward, Keras and TensorFlow &mdash; PL49</title>
  <meta name="author" content="Christopher Bonnett">

  <link href="http://cbonnett.github.io/atom.xml" type="application/atom+xml" rel="alternate"
        title="PL49 Atom Feed" />





  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="http://cbonnett.github.io/favicon.png" rel="icon">

  <link href="http://cbonnett.github.io/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://cbonnett.github.io/">PL49</a></h1>
    <h2>About Machine Learning and Astronomy</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://cbonnett.github.io/atom.xml" rel="subscribe-atom">Atom</a></li>
</ul>


<ul class="main-navigation">
    <li><a href="/archives.html">Archives</a></li>
    <li><a href="https://www.linkedin.com/in/cbonnett">LinkedIn</a></li>
      <li class="active">
        <a href="http://cbonnett.github.io/category/ml.html">Ml</a>
      </li>
      <li >
        <a href="http://cbonnett.github.io/category/ml-in-science.html">Ml in science</a>
      </li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Mixture Density Networks with Edward, Keras and TensorFlow</h1>
    <p class="meta">
<time datetime="2016-05-27T10:20:00+02:00" pubdate>Fri 27 May 2016</time>    </p>
</header>

  <div class="entry-content"><style type="text/css">/*!
*
* IPython notebook
*
*/.ansibold{font-weight:700}.ansiblack{}.ansired{color:#8b0000}.ansigreen{6400}.ansiyellow{color:#c4a000}.ansiblue{8b}.ansipurple{color:#9400d3}.ansicyan{color:#4682b4}.ansigray{color:gray}.ansibgblack{background-}.ansibgred{background-color:red}.ansibggreen{background-color:green}.ansibgyellow{background-color:#ff0}.ansibgblue{background-f}.ansibgpurple{background-color:#ff00ff}.ansibgcyan{background-ff}.ansibggray{background-color:gray}div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;border-radius:2px;box-sizing:border-box;-moz-box-sizing:border-box;border-width:thin;border-style:solid;width:100%;padding:5px;margin:0;outline:0}div.cell.selected{border-color:#ababab}@media print{div.cell.selected{border-color:transparent}}.edit_mode div.cell.selected{border-color:green}.prompt{min-width:14ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}@-moz-document url-prefix(){div.inner_cell{overflow-x:hidden}}div.input_area{border:1px solid #cfcfcf;border-radius:2px;background:#f7f7f7;line-height:1.21429em}div.prompt:empty{padding-top:0;padding-bottom:0}div.unrecognized_cell{padding:5px 5px 5px 0;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.unrecognized_cell .inner_cell{border-radius:2px;padding:5px;font-weight:700;color:red;border:1px solid #cfcfcf;background:#eaeaea}div.unrecognized_cell .inner_cell a,div.unrecognized_cell .inner_cell a:hover{color:inherit;text-decoration:none}@media (max-width:540px){.prompt{text-align:left}div.unrecognized_cell>div.prompt{display:none}}div.code_cell{}div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.input{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.input_prompt{color:navy;border-top:1px solid transparent}div.input_area>div.highlight{margin:.4em;border:none;padding:0;background-color:transparent}div.input_area>div.highlight>pre{margin:0;border:none;padding:0;background-color:transparent}.CodeMirror{line-height:1.21429em;font-size:14px;height:auto;background:0 0}.CodeMirror-scroll{overflow-y:hidden;overflow-x:auto}.CodeMirror-lines{padding:.4em}.CodeMirror-linenumber{padding:0 8px 0 4px}.CodeMirror-gutters{border-bottom-left-radius:2px;border-top-left-radius:2px}.CodeMirror pre{padding:0;border:0;border-radius:0}.highlight-base,.highlight-variable{}.highlight-variable-2{color:#1a1a1a}.highlight-variable-3{color:#333}.highlight-string{color:#BA2121}.highlight-comment{color:#408080;font-style:italic}.highlight-number{80}.highlight-atom{color:#88F}.highlight-keyword{color:green;font-weight:700}.highlight-builtin{color:green}.highlight-error{color:red}.highlight-operator{color:#A2F;font-weight:700}.highlight-meta{color:#A2F}.highlight-def{f}.highlight-string-2{color:#f50}.highlight-qualifier{color:#555}.highlight-bracket{color:#997}.highlight-tag{color:#170}.highlight-attribute{c}.highlight-header{f}.highlight-quote{90}.highlight-link{c}.cm-s-ipython span.cm-keyword{color:green;font-weight:700}.cm-s-ipython span.cm-atom{color:#88F}.cm-s-ipython span.cm-number{80}.cm-s-ipython span.cm-def{f}.cm-s-ipython span.cm-variable{}.cm-s-ipython span.cm-operator{color:#A2F;font-weight:700}.cm-s-ipython span.cm-variable-2{color:#1a1a1a}.cm-s-ipython span.cm-variable-3{color:#333}.cm-s-ipython span.cm-comment{color:#408080;font-style:italic}.cm-s-ipython span.cm-string{color:#BA2121}.cm-s-ipython span.cm-string-2{color:#f50}.cm-s-ipython span.cm-meta{color:#A2F}.cm-s-ipython span.cm-qualifier{color:#555}.cm-s-ipython span.cm-builtin{color:green}.cm-s-ipython span.cm-bracket{color:#997}.cm-s-ipython span.cm-tag{color:#170}.cm-s-ipython span.cm-attribute{c}.cm-s-ipython span.cm-header{f}.cm-s-ipython span.cm-quote{90}.cm-s-ipython span.cm-link{c}.cm-s-ipython span.cm-error{color:red}.cm-s-ipython span.cm-tab{background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAAXNSR0IArs4c6QAAAGFJREFUSMft1LsRQFAQheHPowAKoACx3IgEKtaEHujDjORSgWTH/ZOdnZOcM/sgk/kFFWY0qV8foQwS4MKBCS3qR6ixBJvElOobYAtivseIE120FaowJPN75GMu8j/LfMwNjh4HUpwg4LUAAAAASUVORK5CYII=')right no-repeat}div.output_wrapper{display:-webkit-box;-webkit-box-align:stretch;display:-moz-box;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;z-index:1}div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:2px;-webkit-box-shadow:inset 0 2px 8px rgba(0,0,0,.8);box-shadow:inset 0 2px 8px rgba(0,0,0,.8);display:block}div.output_collapsed{margin:0;padding:0;display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.out_prompt_overlay{height:100%;padding:0 .4em;position:absolute;border-radius:2px}div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000;box-shadow:inset 0 0 1px #000;background:rgba(240,240,240,.5)}div.output_prompt{color:#8b0000}div.output_area{padding:0;page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}div.output_area .MathJax_Display{text-align:left!important}div.output_area div.output_area img,div.output_area svg{max-width:100%;height:auto}div.output_area img.unconfined,div.output_area svg.unconfined{max-width:none}.output{display:-webkit-box;-webkit-box-orient:vertical;display:-moz-box;-moz-box-orient:vertical;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}@media (max-width:540px){div.output_area{-webkit-box-orient:vertical;-moz-box-orient:vertical;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}}div.output_area pre{margin:0;padding:0;border:0;vertical-align:baseline;background-color:transparent;border-radius:0}div.output_subarea{overflow-x:auto;padding:.4em;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1;max-width:calc(100% - 14ex)}div.output_text{text-align:left;line-height:1.21429em}div.output_stderr{background:#fdd}div.output_latex{text-align:left}div.output_javascript:empty{padding:0}.js-error{color:#8b0000}div.raw_input_container{font-family:monospace;padding-top:5px}span.raw_input_prompt{}input.raw_input{font-family:inherit;font-size:inherit;color:inherit;width:auto;vertical-align:baseline;padding:0 .25em;margin:0 .25em}input.raw_input:focus{box-shadow:none}p.p-space{margin-bottom:10px}div.output_unrecognized{padding:5px;font-weight:700;color:red}div.output_unrecognized a,div.output_unrecognized a:hover{color:inherit;text-decoration:none}.rendered_html{}.rendered_html :link,.rendered_html :visited,.rendered_html h1:first-child{margin-top:.538em}.rendered_html h2:first-child{margin-top:.636em}.rendered_html h3:first-child{margin-top:.777em}.rendered_html h4:first-child,.rendered_html h5:first-child,.rendered_html h6:first-child{margin-top:1em}.rendered_html *+ol,.rendered_html *+ul{margin-top:1em}.rendered_html *+table{margin-top:1em}.rendered_html *+p{margin-top:1em}.rendered_html *+img{margin-top:1em}div.text_cell{display:-webkit-box;-webkit-box-orient:horizontal;display:-moz-box;-moz-box-orient:horizontal;display:box;box-orient:horizontal;box-align:stretch;display:flex;flex-direction:row;align-items:stretch}@media (max-width:540px){div.text_cell>div.prompt{display:none}}div.text_cell_render{outline:0;resize:none;width:inherit;border-style:none;padding:.5em .5em .5em .4em;box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box}a.anchor-link:link{text-decoration:none;padding:0 20px;visibility:hidden}h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible}.text_cell.rendered .input_area{display:none}.text_cell.rendered .text_cell.unrendered .text_cell_render{display:none}.cm-header-1,.cm-header-2,.cm-header-3,.cm-header-4,.cm-header-5,.cm-header-6{font-weight:700;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}.cm-header-1{font-size:185.7%}.cm-header-2{font-size:157.1%}.cm-header-3{font-size:128.6%}.cm-header-4{font-size:110%}.cm-header-5,.cm-header-6{font-size:100%;font-style:italic}</style>
<style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the <a href="http://cbonnett.github.io/MDN.html">previous blog post</a> we looked at what a Mixture Density Network is with an implementation in TensorFlow. We then used this to learn the distance to galaxies on a simulated data set. In this blog post we'll show an easier way to code an MDN by combining the power of three python libraries.</p>
<ol>
<li><a href="https://github.com/blei-lab/edward">Edward</a></li>
<li><a href="http://keras.io/">Keras</a> </li>
<li><a href="http://tensorflow.org">TensorFlow</a> </li>
</ol>
<p>You are likely familiar with number 2 and 3 so let me tell you a bit about the first. Edward is a python library
for probabilistic modelling, inference, and criticism. It's goal it to fuse the related areas of Bayesian Statistics, Machine Learning, Deep Learning and Probabilistic Programming. Edward is developed by the group of <a href="http://www.cs.columbia.edu/~blei/">David Blei</a> at Columbia University with the main developer being <a href="https://twitter.com/dustinvtran">Dustin Tran</a>. The example we discuss here is based on the <a href="https://github.com/blei-lab/edward/blob/master/examples/mixture_density_network.py">example</a> in the Edward repo that was written by Dustin and <a href="https://twitter.com/cbonnett">myself</a>.</p>
<p>Edward implements many probability distribution functions that are TensorFlow compatible, this makes it attractive to use for MDN's. In the <a href="http://cbonnett.github.io/MDN.html">previous blog post</a> we had to roll our own $Beta$ distribution, with Edward this is no longer necessary. One note to keep in mind, if you want to use Keras and TensorFlow like we will do in this post you need to set the backend of Keras to TensorFlow, <a href="http://keras.io/backend/">here</a> it is explained how to do that.</p>
<p>Here are all the distributions that are currently implemented in Edward, there are more to come:</p>
<ol>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L49">Bernoulli</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L58">Beta</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L68">Binomial</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L79">Chi Squared</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L89">Dirichlet</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L109">Exponential</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L118">Gamma</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L129">Geometric</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L138">Inverse Gamma</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L155">log Normal</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L165">Multinomial</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L194">Multivariate Normal</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L283">Negative Binomial</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L294">Normal</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L310">Poisson</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L319">Student-t</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L333">Truncated Normal</a></li>
<li><a href="https://github.com/blei-lab/edward/blob/master/edward/stats/distributions.py#L352">Uniform</a></li>
</ol>
<p>Which all can be used to make a Mixture Density Networks. Let start by doing the imports.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># imports</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="kn">import</span> <span class="nn">edward</span> <span class="kn">as</span> <span class="nn">ed</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="kn">from</span> <span class="nn">edward.stats</span> <span class="kn">import</span> <span class="n">norm</span> <span class="c1"># normal distrubtion from Edward ! </span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span> <span class="k">as</span> <span class="n">K</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Make-some-toy-data-to-play-with.">Make some toy-data to play with.<a class="anchor-link" href="#Make-some-toy-data-to-play-with.">¶</a></h2><p>This is the same toy-data problem set as used in the <a href="http://blog.otoro.net/2015/11/24/mixture-density-networks-with-tensorflow/">blog post</a> by Otoro where he explains MDNs. This is an inverse problem as you can see, for every <code>X</code> there are multiple possible <code>y</code> solutions.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">def</span> <span class="nf">build_toy_dataset</span><span class="p">(</span><span class="n">nsample</span><span class="o">=</span><span class="mi">40000</span><span class="p">):</span>
    <span class="n">y_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nsample</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">r_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">nsample</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span> <span class="c1"># random noise</span>
    <span class="n">x_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">0.75</span><span class="o">*</span><span class="n">y_data</span><span class="p">)</span><span class="o">*</span><span class="mf">7.0</span><span class="o">+</span><span class="n">y_data</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">r_data</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">x_data</span><span class="p">,</span> <span class="n">y_data</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">build_toy_dataset</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Size of features in training data: {:s}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Size of output in training data: {:s}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Size of features in test data: {:s}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"Size of output in test data: {:s}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">fit_reg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>Size of features in training data: (4000, 1)
Size of output in training data: (4000, 1)
Size of features in test data: (36000, 1)
Size of output in test data: (36000, 1)
</pre>
</div>
</div>
<div class="output_area"><div class="prompt output_prompt">Out[5]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x103eee650&gt;</pre>
</div>
</div>
<div class="output_area"><div class="prompt"></div>
<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
">
</img></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Build-the-MDN-using-Keras-and-TF">Build the MDN using Keras and TF<a class="anchor-link" href="#Build-the-MDN-using-Keras-and-TF">¶</a></h3><p>We will define a class that can be used to construct MDNs. We will be using a mixture of Normal Distributions.
The advantage of defining a class is that we can easily reuse this to build other MDNs with different amount of
mixture components. Furthermore, this makes it play nicely with Edward.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="k">class</span> <span class="nc">MixtureDensityNetwork</span><span class="p">:</span>
    <span class="sd">"""</span>
<span class="sd">    Mixture density network for outputs y on inputs x.</span>
<span class="sd">    p((x,y), (z,theta))</span>
<span class="sd">    = sum_{k=1}^K pi_k(x; theta) Normal(y; mu_k(x; theta), sigma_k(x; theta))</span>
<span class="sd">    where pi, mu, sigma are the output of a neural network taking x</span>
<span class="sd">    as input and with parameters theta. There are no latent variables</span>
<span class="sd">    z, which are hidden variables we aim to be Bayesian about.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">K</span> <span class="c1"># here K is the amount of Mixtures </span>

    <span class="k">def</span> <span class="nf">mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">"""pi, mu, sigma = NN(x; theta)"""</span>
        <span class="n">hidden1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># fully-connected layer with 15 hidden units</span>
        <span class="n">hidden2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">)(</span><span class="n">hidden1</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">mus</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">)(</span><span class="n">hidden2</span><span class="p">)</span> <span class="c1"># the means </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmas</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">exp</span><span class="p">)(</span><span class="n">hidden2</span><span class="p">)</span> <span class="c1"># the variance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pi</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">K</span><span class="o">.</span><span class="n">softmax</span><span class="p">)(</span><span class="n">hidden2</span><span class="p">)</span> <span class="c1"># the mixture components</span>

    <span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">zs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">"""log p((xs,ys), (z,theta)) = sum_{n=1}^N log p((xs[n,:],ys[n]), theta)"""</span>
        <span class="c1"># Note there are no parameters we're being Bayesian about. The</span>
        <span class="c1"># parameters are baked into how we specify the neural networks.</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigmas</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">reduce_sum</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can set a seed in Edward so we can reproduce all the random components, this sets the seed in numpy and TensorFlow under the <a href="https://github.com/blei-lab/edward/blob/master/edward/util.py#L191">hood</a>.
We use the class we defined above to initiate the MDN with 20 mixtures, this now can be used as an Edward model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">ed</span><span class="o">.</span><span class="n">set_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">MixtureDensityNetwork</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the following code cell we define the TensorFlow place holders that are then use to define the Edward data model.
The following line passes the <code>model</code> and <code>data</code> to <code>MAP</code> from Edward which is then used to initialise the TensorFlow variables.</p>
<p><code>inference = ed.MAP(model, data)</code></p>
<p>MAP is a Bayesian concepts and stands for Maximum A Posteriori, it tries to find the set of parameters which maximize the posterior distribution. In the example here we don't have a prior, in a Bayesian context this means we have a flat prior. For a flat prior MAP is equivalent to Maximum Likelihood estimation. Edward is designed to be Bayesian about it's statistial inference. The cool thing about MDN's with Edward  is that we could easily include priors!</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span> <span class="c1"># Make Edward Data model</span>

<span class="n">inference</span> <span class="o">=</span> <span class="n">ed</span><span class="o">.</span><span class="n">MAP</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="c1"># Make the inference model</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="c1"># start TF session </span>
<span class="n">K</span><span class="o">.</span><span class="n">set_session</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span> <span class="c1"># pass session info to Keras</span>
<span class="n">inference</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">sess</span><span class="o">=</span><span class="n">sess</span><span class="p">)</span> <span class="c1"># initialize all TF variables using the Edward interface </span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">Out[ ]:</div>
<div class="output_text output_subarea output_execute_result">
<pre>&lt;tensorflow.python.client.session.Session at 0x10e6eeed0&gt;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Having done that we can train the MDN in TensorFlow just like we normally would, and we can get out the predictions we are interested in from <code>model</code> in this case</p>
<ul>
<li><code>model.pi</code> the mixture components, </li>
<li><code>model.mus</code> the means,</li>
<li><code>model.sigmas</code> the standard  deviations.   </li>
</ul>
<p>This is done in the last line of the code cell :</p>
<pre><code>pred_weights, pred_means, pred_std = sess.run([model.pi, model.mus, model.sigmas], feed_dict={X: X_test})</code></pre>
<p>The default minimisation technique used is ADAM with a decaying scale factor.
This can be seen <a href="https://github.com/blei-lab/edward/blob/master/edward/inferences.py#L94">here</a> in the code base of Edward. Having a decaying scale factor is not the standard way of using ADAM, this is inspired by the Automatic Differentiation Variational Inference <a href="http://arxiv.org/abs/1603.00788">(ADVI)</a> work where it was used in the RMSPROP minimizer.</p>
<p>The loss that is minimised in the <code>MAP</code> model from Edward is the negative log-likelihood, this calculation used the  <code>log_prob</code> method in the <code>MixtureDensityNetwork</code> class we defined above. 
The <code>build_loss</code> method in the <code>MAP</code> class can be found <a href="https://github.com/blei-lab/edward/blob/master/edward/inferences.py#L396">here</a>.</p>
<p>However the method <code>inference.loss</code> used below, returns the log-likelihood, so we expect this quantity to maximized.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">NEPOCH</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">train_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NEPOCH</span><span class="p">)</span>
<span class="n">test_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">NEPOCH</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NEPOCH</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">inference</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">inference</span><span class="o">.</span><span class="n">loss</span><span class="p">],</span>
                                <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_train</span><span class="p">})</span>
    <span class="n">test_loss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inference</span><span class="o">.</span><span class="n">loss</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">y_test</span><span class="p">})</span>
    
<span class="n">pred_weights</span><span class="p">,</span> <span class="n">pred_means</span><span class="p">,</span> <span class="n">pred_std</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">model</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">mus</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">sigmas</span><span class="p">],</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">X</span><span class="p">:</span> <span class="n">X_test</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can plot the log-likelihood of the training and test sample as function of training epoch.
Keep in mind that <code>inference.loss</code> returns the total log-likelihood, so not the loss per data point, so in the plotting routine we divide by the size of the train and test data respectively. 
We see that it converges after 400-500 training steps.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NEPOCH</span><span class="p">),</span> <span class="n">test_loss</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">NEPOCH</span><span class="p">),</span> <span class="n">train_loss</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Train'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epoch'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Log-likelihood'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we can have a look at how some individual examples perform. Keep in mind this is an inverse problem
so we can't get the answer correct, we can hope that the truth lies in area where the model has high probability.
In the next plot the truth is the vertical grey line while the blue line is the prediction of the mixture denstiy network. As you can see, we didn't do too bad.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plot_normal_mix</span><span class="p">(</span><span class="n">pred_weights</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pred_means</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">pred_std</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">comp</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plot_normal_mix</span><span class="p">(</span><span class="n">pred_weights</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">pred_means</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">pred_std</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">comp</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plot_normal_mix</span><span class="p">(</span><span class="n">pred_weights</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pred_means</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pred_std</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">comp</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_test</span><span class="p">[</span><span class="n">obj</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can check the ensemble by drawing samples of the prediction and plotting the density of those. 
Seems the MDN learned what it needed too.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">sample_from_mixture</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">pred_weights</span><span class="p">,</span> <span class="n">pred_means</span><span class="p">,</span> <span class="n">pred_std</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s2">"hex"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"#4CB391"</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Thanks">Thanks<a class="anchor-link" href="#Thanks">¶</a></h2><p>Thanks to Dustin Tran for working on this with me.</p>
<p>This entire post was written in an ipython notebook which can be found <a href="https://github.com/cbonnett/MDN_Edward_Keras_TF/blob/master/MDN_Edward_Keras_TF.ipynb">here</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
<div class="input_area">
<div class=" highlight hl-ipython2"><pre><span></span><span class="c1"># Helper functions</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span> <span class="k">as</span> <span class="n">normal</span>
<span class="k">def</span> <span class="nf">plot_normal_mix</span><span class="p">(</span><span class="n">pis</span><span class="p">,</span> <span class="n">mus</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Plots the mixture of Normal models to axis=ax</span>
<span class="sd">    comp=True plots all components of mixtur model</span>
<span class="sd">    """</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">10.5</span><span class="p">,</span> <span class="mf">10.5</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="n">final</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">weight_mix</span><span class="p">,</span> <span class="n">mu_mix</span><span class="p">,</span> <span class="n">sigma_mix</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pis</span><span class="p">,</span> <span class="n">mus</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">)):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu_mix</span><span class="p">,</span> <span class="n">sigma_mix</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight_mix</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">final</span> <span class="o">+</span> <span class="n">temp</span>
        <span class="k">if</span> <span class="n">comp</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Normal '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Mixture of Normals '</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">sample_from_mixture</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pred_weights</span><span class="p">,</span> <span class="n">pred_means</span><span class="p">,</span> <span class="n">pred_std</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Draws samples from mixture model. </span>
<span class="sd">    Returns 2 d array with input X and sample from prediction of Mixture Model</span>
<span class="sd">    """</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">n_mix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_weights</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">to_choose_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_mix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,(</span><span class="n">weights</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">std_devs</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">pred_weights</span><span class="p">,</span> <span class="n">pred_means</span><span class="p">,</span> <span class="n">pred_std</span><span class="p">)):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">to_choose_from</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">std_devs</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">amount</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">samples</span>
</pre></div>
</div>
</div>
</div>
</div>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var mathjaxscript = document.createElement('script');
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: 'center'," +
        "    displayIndent: '0em'," +
        "    showMathMenu: true," +
        "    tex2jax: { " +
        "        inlineMath: [ ['$','$'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
        "    } " +
        "}); ";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
</div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">
        Christopher Bonnett
    </span>
  </span>
<time datetime="2016-05-27T10:20:00+02:00" pubdate>Fri 27 May 2016</time>  <span class="categories">
    <a class='category' href='http://cbonnett.github.io/category/ml.html'>ML</a>
  </span>
  <span class="categories">
    <a class="category" href="http://cbonnett.github.io/tag/edward.html">Edward</a>,    <a class="category" href="http://cbonnett.github.io/tag/keras.html">Keras</a>,    <a class="category" href="http://cbonnett.github.io/tag/tensorflow.html">TensorFlow</a>,    <a class="category" href="http://cbonnett.github.io/tag/mdn.html">MDN</a>  </span>
</p><div class="sharing">
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://cbonnett.github.io/MDN_EDWARD_KERAS_TF.html" data-via="cbonnett" data-counturl="http://cbonnett.github.io/MDN_EDWARD_KERAS_TF.html" >Tweet</a>
</div>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://cbonnett.github.io/MDN_EDWARD_KERAS_TF.html">Mixture Density Networks with Edward, Keras and TensorFlow</a>
      </li>
      <li class="post">
          <a href="http://cbonnett.github.io/MDN.html">Mixture Density Networks for Galaxy distance determination in TensorFlow</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://cbonnett.github.io/category/ml.html">ML</a></li>
        <li><a href="http://cbonnett.github.io/category/ml-in-science.html">ML in science</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
    <a href="http://cbonnett.github.io/tag/redshift.html">redshift</a>,    <a href="http://cbonnett.github.io/tag/tensorflow.html">TensorFlow</a>,    <a href="http://cbonnett.github.io/tag/edward.html">Edward</a>,    <a href="http://cbonnett.github.io/tag/mdn.html">MDN</a>,    <a href="http://cbonnett.github.io/tag/keras.html">Keras</a>  </section>



<section>
    <a href="http://twitter.com/cbonnett" class="twitter-follow-button" data-show-count="true">Follow @cbonnett</a>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2016  Christopher Bonnett &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="http://cbonnett.github.io/theme/js/modernizr-2.0.js"></script>
  <script src="http://cbonnett.github.io/theme/js/ender.js"></script>
  <script src="http://cbonnett.github.io/theme/js/octopress.js" type="text/javascript"></script>
  <script type="text/javascript">
    var disqus_shortname = 'mk49';
    var disqus_identifier = '/MDN_EDWARD_KERAS_TF.html';
    var disqus_url = 'http://cbonnett.github.io/MDN_EDWARD_KERAS_TF.html';
    var disqus_title = 'Mixture Density Networks with Edward, Keras and TensorFlow';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
</body>
</html>    

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-9853651-2', 'auto');
  ga('send', 'pageview');

</script>